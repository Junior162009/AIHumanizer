<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Humanizador de Textos - Anti Detector IA</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4cb5ae;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark-color);
            background-color: #f5f7fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem 0;
            text-align: center;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section, .output-section {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        h2 {
            color: var(--secondary-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--accent-color);
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        .word-count {
            text-align: right;
            margin-top: 10px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }
        
        button {
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary {
            background-color: #e9ecef;
            color: var(--dark-color);
        }
        
        .btn-secondary:hover {
            background-color: #dee2e6;
        }
        
        .processing-indicator {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--secondary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .quality-indicator {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 5px;
            border-left: 4px solid #4caf50;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        .advanced-options {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .option-group {
            margin-bottom: 10px;
        }
        
        .option-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .option-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .history-section {
            margin-top: 30px;
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .history-list {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
            padding: 10px;
        }
        
        .history-item {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .history-item:hover {
            background-color: #f5f5f5;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .history-date {
            font-size: 0.8rem;
            color: #888;
        }
        
        .ai-score {
            margin-top: 15px;
            padding: 10px;
            background-color: #fff3cd;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        
        .score-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .score-fill {
            height: 100%;
            background-color: #4caf50;
            border-radius: 5px;
            transition: width 0.5s;
        }
        
        .human-percentage {
            font-weight: bold;
            color: var(--secondary-color);
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Humanizador de Textos - Anti Detector IA</h1>
            <p class="subtitle">Convierte textos de IA en escritura humana indetectable</p>
        </div>
    </header>
    
    <div class="container">
        <div class="main-content">
            <section class="input-section">
                <h2>Texto Original (IA)</h2>
                <textarea id="original-text" placeholder="Pega aquí tu texto generado por IA (hasta 10,000 palabras)..."></textarea>
                <div class="word-count" id="word-count">Palabras: 0</div>
                
                <div class="advanced-options">
                    <h3>Técnicas Anti-Detección</h3>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="add-human-errors" checked>
                            Añadir errores humanos leves
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="vary-sentence-structure" checked>
                            Variar estructura de oraciones
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="add-colloquialisms" checked>
                            Añadir expresiones coloquiales
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="break-patterns" checked>
                            Romper patrones de IA
                        </label>
                    </div>
                    <div class="option-group">
                        <label>
                            <input type="checkbox" id="add-personal-touch">
                            Añadir toque personal
                        </label>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="btn-secondary" id="clear-btn">Limpiar</button>
                    <button class="btn-primary" id="humanize-btn">Humanizar Texto</button>
                </div>
                
                <div class="processing-indicator" id="processing-indicator">
                    <div class="spinner"></div>
                    <p>Aplicando técnicas anti-detección... Esto puede tomar unos segundos</p>
                </div>
            </section>
            
            <section class="output-section">
                <h2>Texto Humanizado</h2>
                <textarea id="humanized-text" readonly placeholder="Aquí aparecerá tu texto humanizado e indetectable..."></textarea>
                
                <div class="ai-score" id="ai-score" style="display: none;">
                    <p>Probabilidad de detección como IA: <span class="human-percentage" id="ai-percentage">0%</span></p>
                    <div class="score-bar">
                        <div class="score-fill" id="score-fill" style="width: 0%"></div>
                    </div>
                    <p id="ai-assessment">El texto parece completamente humano</p>
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="original-words">0</div>
                        <div class="stat-label">Palabras originales</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="humanized-words">0</div>
                        <div class="stat-label">Palabras humanizadas</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="readability-score">0</div>
                        <div class="stat-label">Legibilidad</div>
                    </div>
                </div>
                
                <div class="quality-indicator" id="quality-indicator" style="display: none;">
                    <p>✅ Tu texto ha sido humanizado exitosamente. La probabilidad de detección como IA se ha reducido significativamente.</p>
                </div>
                
                <div class="controls">
                    <button class="btn-secondary" id="copy-btn">Copiar Texto</button>
                    <button class="btn-secondary" id="download-btn">Descargar</button>
                </div>
            </section>
        </div>
        
        <section class="history-section">
            <h2>Historial de Textos</h2>
            <p>Haz clic en cualquier elemento del historial para cargarlo de nuevo</p>
            <div class="history-list" id="history-list">
                <!-- El historial se cargará aquí dinámicamente -->
            </div>
            <div class="controls">
                <button class="btn-secondary" id="clear-history-btn">Limpiar Historial</button>
            </div>
        </section>
        
        <div class="footer">
            <p>Aplicación desarrollada con HTML, CSS y JavaScript - Técnicas Anti-Detección IA</p>
            <p>© 2023 Humanizador de Textos - Todos los derechos reservados</p>
        </div>
    </div>

    <script>
        // Clase para humanizar textos con técnicas anti-detección de IA
        class TextHumanizer {
            constructor() {
                this.replacements = {
                    'utilizar': 'usar',
                    'finalizar': 'terminar',
                    'iniciar': 'empezar',
                    'poseer': 'tener',
                    'visualizar': 'ver',
                    'efectuar': 'hacer',
                    'facilitar': 'ayudar',
                    'obtener': 'conseguir',
                    'proporcionar': 'dar',
                    'requerir': 'necesitar',
                    'adicionalmente': 'además',
                    'consecuentemente': 'por lo tanto',
                    'no obstante': 'sin embargo',
                    'en cuanto a': 'sobre',
                    'debido a que': 'porque',
                    'a fin de que': 'para que',
                    'con el propósito de': 'para',
                    'en relación con': 'sobre',
                    'por medio de': 'mediante',
                    'en caso de que': 'si',
                    'a pesar de que': 'aunque',
                    'en virtud de': 'gracias a',
                    'con anterioridad': 'antes',
                    'posteriormente': 'después',
                    'en definitiva': 'en resumen',
                    'es preciso': 'hay que',
                    'resulta evidente': 'es claro',
                    'llevar a cabo': 'hacer',
                    'poner en marcha': 'iniciar',
                    'tener en cuenta': 'considerar',
                    'en primer lugar': 'primero',
                    'en segundo lugar': 'segundo',
                    'por último': 'finalmente',
                    'de acuerdo con': 'según',
                    'con respecto a': 'sobre',
                    'en cuanto a': 'respecto a',
                    'así como también': 'y también',
                    'de la misma manera': 'igual',
                    'en otras palabras': 'es decir',
                    'cabe destacar': 'es importante',
                    'es importante señalar': 'hay que decir',
                    'vale la pena mencionar': 'conviene mencionar'
                };
                
                this.colloquialExpressions = [
                    'o sea',
                    'digamos',
                    'bueno',
                    'pues',
                    'vamos',
                    'fíjate',
                    'mira',
                    'oye',
                    'claro',
                    'desde luego',
                    'por supuesto',
                    'la verdad',
                    'a ver',
                    'entonces',
                    'total',
                    'en fin',
                    'así que',
                    'pues eso',
                    'ya sabes',
                    'como te decía'
                ];
                
                this.humanErrors = [
                    { from: 'haber', to: 'a ver' },
                    { from: 'halla', to: 'haya' },
                    { from: 'aya', to: 'haya' },
                    { from: 'echo', to: 'hecho' },
                    { from: 'haiga', to: 'haya' },
                    { from: 'iba', to: 'iva' },
                    { from: 'valla', to: 'vaya' },
                    { from: 'raya', to: 'ralla' },
                    { from: 'hechar', to: 'echar' },
                    { from: 'cabo', to: 'caso' }
                ];
                
                this.personalExpressions = [
                    'En mi opinión',
                    'Desde mi punto de vista',
                    'Personalmente creo que',
                    'Me parece que',
                    'A mi entender',
                    'En mi experiencia',
                    'Si me preguntas a mí',
                    'Yo diría que',
                    'A mi modo de ver',
                    'Desde mi perspectiva'
                ];
            }
            
            humanizeText(text, options = {}) {
                let humanizedText = text;
                
                // Reemplazar palabras formales por informales
                if (options.replaceFormalWords !== false) {
                    humanizedText = this.replaceFormalWords(humanizedText);
                }
                
                // Variar estructura de oraciones
                if (options.varySentenceStructure) {
                    humanizedText = this.varySentenceStructure(humanizedText);
                }
                
                // Añadir expresiones coloquiales
                if (options.addColloquialisms) {
                    humanizedText = this.addColloquialisms(humanizedText);
                }
                
                // Romper patrones de IA
                if (options.breakPatterns) {
                    humanizedText = this.breakPatterns(humanizedText);
                }
                
                // Añadir toque personal
                if (options.addPersonalTouch) {
                    humanizedText = this.addPersonalTouch(humanizedText);
                }
                
                // Añadir errores humanos leves (opcional)
                if (options.addHumanErrors) {
                    humanizedText = this.addHumanErrors(humanizedText);
                }
                
                return humanizedText;
            }
            
            replaceFormalWords(text) {
                let result = text;
                
                for (const [formal, informal] of Object.entries(this.replacements)) {
                    const regex = new RegExp(`\\b${formal}\\b`, 'gi');
                    result = result.replace(regex, informal);
                }
                
                return result;
            }
            
            varySentenceStructure(text) {
                const sentences = text.split(/(?<=[.!?])\s+/);
                const variedSentences = [];
                
                for (let i = 0; i < sentences.length; i++) {
                    let sentence = sentences[i];
                    
                    // Cada 3-4 oraciones, cambiar la estructura
                    if (i % 4 === 0 && sentence.length > 20) {
                        // Convertir algunas oraciones en preguntas retóricas
                        if (i % 8 === 0) {
                            sentence = this.convertToRhetoricalQuestion(sentence);
                        }
                        // Dividir oraciones largas
                        else if (sentence.split(' ').length > 25) {
                            const parts = this.splitLongSentence(sentence);
                            variedSentences.push(parts[0]);
                            if (parts[1]) variedSentences.push(parts[1]);
                            continue;
                        }
                        // Combinar oraciones cortas
                        else if (i > 0 && sentences[i-1].split(' ').length < 8 && 
                                 sentence.split(' ').length < 10) {
                            sentence = sentences[i-1] + ' y ' + sentence.toLowerCase();
                            variedSentences.pop(); // Eliminar la oración anterior
                        }
                    }
                    
                    variedSentences.push(sentence);
                }
                
                return variedSentences.join(' ');
            }
            
            convertToRhetoricalQuestion(sentence) {
                // Convertir una oración afirmativa en pregunta retórica
                if (sentence.endsWith('.')) {
                    sentence = sentence.slice(0, -1);
                    
                    const questionPhrases = [
                        '¿No crees?',
                        '¿Verdad?',
                        '¿No te parece?',
                        '¿Qué opinas?',
                        '¿No es así?'
                    ];
                    
                    const randomPhrase = questionPhrases[Math.floor(Math.random() * questionPhrases.length)];
                    return sentence + '. ' + randomPhrase;
                }
                
                return sentence;
            }
            
            splitLongSentence(sentence) {
                const words = sentence.split(' ');
                if (words.length <= 15) return [sentence];
                
                // Encontrar un punto natural para dividir (después de una coma o conjunción)
                let splitIndex = Math.floor(words.length / 2);
                for (let i = splitIndex; i < words.length - 3; i++) {
                    if (words[i].endsWith(',') || 
                        ['y', 'o', 'pero', 'aunque', 'sin embargo'].includes(words[i].toLowerCase())) {
                        splitIndex = i + 1;
                        break;
                    }
                }
                
                const firstPart = words.slice(0, splitIndex).join(' ');
                const secondPart = words.slice(splitIndex).join(' ');
                
                return [firstPart, this.capitalizeFirstLetter(secondPart)];
            }
            
            addColloquialisms(text) {
                const sentences = text.split(/(?<=[.!?])\s+/);
                
                // Añadir expresiones coloquiales cada 5-7 oraciones
                for (let i = 5; i < sentences.length; i += Math.floor(Math.random() * 3) + 5) {
                    const randomExpression = this.colloquialExpressions[
                        Math.floor(Math.random() * this.colloquialExpressions.length)
                    ];
                    
                    // Añadir al inicio o final de la oración
                    if (Math.random() > 0.5) {
                        sentences[i] = randomExpression + ', ' + sentences[i].toLowerCase();
                    } else {
                        sentences[i] = sentences[i] + ', ' + randomExpression + '.';
                    }
                }
                
                return sentences.join(' ');
            }
            
            breakPatterns(text) {
                // Romper patrones repetitivos típicos de IA
                let result = text;
                
                // Variar conectores
                result = result.replace(/Además, /g, () => 
                    Math.random() > 0.5 ? 'Por otro lado, ' : 'También, ');
                
                result = result.replace(/Sin embargo, /g, () => 
                    Math.random() > 0.5 ? 'No obstante, ' : 'En cambio, ');
                
                result = result.replace(/Por lo tanto, /g, () => 
                    Math.random() > 0.5 ? 'Así que, ' : 'Por eso, ');
                
                // Variar inicios de párrafo
                result = result.replace(/En primer lugar, /g, 'Para empezar, ');
                result = result.replace(/En segundo lugar, /g, 'Después, ');
                result = result.replace(/En conclusión, /g, 'En resumen, ');
                
                return result;
            }
            
            addPersonalTouch(text) {
                const sentences = text.split(/(?<=[.!?])\s+/);
                
                // Añadir expresiones personales cada 6-8 oraciones
                for (let i = 6; i < sentences.length; i += Math.floor(Math.random() * 3) + 6) {
                    const randomExpression = this.personalExpressions[
                        Math.floor(Math.random() * this.personalExpressions.length)
                    ];
                    
                    sentences[i] = randomExpression + ', ' + sentences[i].toLowerCase();
                }
                
                return sentences.join(' ');
            }
            
            addHumanErrors(text) {
                let result = text;
                
                // Añadir algunos errores humanos comunes (ligeros)
                const errorCount = Math.max(1, Math.floor(text.length / 2000)); // ~1 error cada 2000 caracteres
                
                for (let i = 0; i < errorCount; i++) {
                    const error = this.humanErrors[Math.floor(Math.random() * this.humanErrors.length)];
                    const regex = new RegExp(`\\b${error.from}\\b`, 'gi');
                    
                    // Solo reemplazar si encontramos la palabra y con una probabilidad del 50%
                    if (result.match(regex) && Math.random() > 0.5) {
                        result = result.replace(regex, error.to);
                    }
                }
                
                return result;
            }
            
            calculateReadability(text) {
                // Fórmula simplificada de legibilidad
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
                const words = text.split(/\s+/).filter(w => w.length > 0);
                
                if (sentences.length === 0 || words.length === 0) {
                    return 0;
                }
                
                const avgSentenceLength = words.length / sentences.length;
                const avgWordLength = words.reduce((sum, word) => sum + word.length, 0) / words.length;
                
                // Fórmula simplificada basada en longitud de oraciones y palabras
                let readability = 100 - (avgSentenceLength * 1.5 + avgWordLength * 10);
                readability = Math.max(0, Math.min(100, readability));
                
                return Math.round(readability);
            }
            
            estimateAIDetection(text) {
                // Estimación basada en patrones típicos de texto de IA
                let aiScore = 0;
                
                // Patrones que aumentan la probabilidad de detección
                const aiPatterns = [
                    { pattern: /En primer lugar|En segundo lugar|En tercer lugar/g, weight: 3 },
                    { pattern: /Además|Por otra parte|Asimismo/g, weight: 2 },
                    { pattern: /Sin embargo|No obstante|Por el contrario/g, weight: 2 },
                    { pattern: /En conclusión|En resumen|Finalmente/g, weight: 3 },
                    { pattern: /Es importante destacar|Cabe mencionar|Vale la pena señalar/g, weight: 2 },
                    { pattern: /Por un lado|Por otro lado/g, weight: 2 },
                    { pattern: /De esta manera|De este modo/g, weight: 2 },
                    { pattern: /En cuanto a|Respecto a|En relación con/g, weight: 2 }
                ];
                
                // Calcular puntuación basada en patrones
                for (const { pattern, weight } of aiPatterns) {
                    const matches = text.match(pattern);
                    if (matches) {
                        aiScore += matches.length * weight;
                    }
                }
                
                // Considerar longitud promedio de oraciones (las IA tienden a oraciones más largas)
                const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
                const avgSentenceLength = text.split(/\s+/).length / sentences.length;
                
                if (avgSentenceLength > 20) aiScore += 5;
                if (avgSentenceLength > 25) aiScore += 5;
                
                // Considerar uniformidad en la estructura
                const sentenceLengths = sentences.map(s => s.split(/\s+/).length);
                const lengthVariance = this.calculateVariance(sentenceLengths);
                
                // Menor variación = más probable que sea IA
                if (lengthVariance < 50) aiScore += 5;
                
                // Normalizar puntuación (0-100)
                const normalizedScore = Math.min(100, Math.max(0, aiScore));
                
                return 100 - normalizedScore; // Devolvemos el porcentaje de "humanidad"
            }
            
            calculateVariance(numbers) {
                if (numbers.length === 0) return 0;
                
                const mean = numbers.reduce((sum, num) => sum + num, 0) / numbers.length;
                const squaredDiffs = numbers.map(num => Math.pow(num - mean, 2));
                const variance = squaredDiffs.reduce((sum, diff) => sum + diff, 0) / numbers.length;
                
                return variance;
            }
            
            capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
        }

        // Inicialización cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            const humanizer = new TextHumanizer();
            const originalText = document.getElementById('original-text');
            const humanizedText = document.getElementById('humanized-text');
            const wordCount = document.getElementById('word-count');
            const humanizeBtn = document.getElementById('humanize-btn');
            const clearBtn = document.getElementById('clear-btn');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const processingIndicator = document.getElementById('processing-indicator');
            const originalWords = document.getElementById('original-words');
            const humanizedWords = document.getElementById('humanized-words');
            const readabilityScore = document.getElementById('readability-score');
            const qualityIndicator = document.getElementById('quality-indicator');
            const historyList = document.getElementById('history-list');
            const clearHistoryBtn = document.getElementById('clear-history-btn');
            const aiScoreElement = document.getElementById('ai-score');
            const aiPercentage = document.getElementById('ai-percentage');
            const scoreFill = document.getElementById('score-fill');
            const aiAssessment = document.getElementById('ai-assessment');
            
            // Opciones de humanización
            const addHumanErrors = document.getElementById('add-human-errors');
            const varySentenceStructure = document.getElementById('vary-sentence-structure');
            const addColloquialisms = document.getElementById('add-colloquialisms');
            const breakPatterns = document.getElementById('break-patterns');
            const addPersonalTouch = document.getElementById('add-personal-touch');
            
            // Cargar historial desde localStorage
            loadHistory();
            
            // Actualizar contador de palabras
            originalText.addEventListener('input', function() {
                const text = originalText.value.trim();
                const words = text ? text.split(/\s+/).length : 0;
                wordCount.textContent = `Palabras: ${words}`;
                
                // Deshabilitar botón si hay más de 10,000 palabras
                if (words > 10000) {
                    humanizeBtn.disabled = true;
                    wordCount.innerHTML = `Palabras: <span style="color:red">${words} (Límite: 10,000)</span>`;
                } else {
                    humanizeBtn.disabled = false;
                }
            });
            
            // Limpiar texto
            clearBtn.addEventListener('click', function() {
                originalText.value = '';
                humanizedText.value = '';
                wordCount.textContent = 'Palabras: 0';
                qualityIndicator.style.display = 'none';
                aiScoreElement.style.display = 'none';
                originalWords.textContent = '0';
                humanizedWords.textContent = '0';
                readabilityScore.textContent = '0';
            });
            
            // Humanizar texto
            humanizeBtn.addEventListener('click', function() {
                const text = originalText.value.trim();
                if (!text) {
                    alert('Por favor, ingresa un texto para humanizar.');
                    return;
                }
                
                const wordCount = text.split(/\s+/).length;
                if (wordCount > 10000) {
                    alert('El texto excede el límite de 10,000 palabras.');
                    return;
                }
                
                // Mostrar indicador de procesamiento
                processingIndicator.style.display = 'block';
                humanizeBtn.disabled = true;
                
                // Usar setTimeout para permitir que la UI se actualice
                setTimeout(function() {
                    try {
                        // Obtener opciones seleccionadas
                        const options = {
                            addHumanErrors: addHumanErrors.checked,
                            varySentenceStructure: varySentenceStructure.checked,
                            addColloquialisms: addColloquialisms.checked,
                            breakPatterns: breakPatterns.checked,
                            addPersonalTouch: addPersonalTouch.checked
                        };
                        
                        // Humanizar texto
                        const humanized = humanizer.humanizeText(text, options);
                        
                        // Calcular estadísticas
                        const originalWordCount = text.split(/\s+/).length;
                        const humanizedWordCount = humanized.split(/\s+/).length;
                        const readability = humanizer.calculateReadability(humanized);
                        const aiDetectionScore = humanizer.estimateAIDetection(humanized);
                        
                        // Mostrar resultado
                        humanizedText.value = humanized;
                        originalWords.textContent = originalWordCount;
                        humanizedWords.textContent = humanizedWordCount;
                        readabilityScore.textContent = readability;
                        qualityIndicator.style.display = 'block';
                        aiScoreElement.style.display = 'block';
                        
                        // Actualizar indicador de detección de IA
                        aiPercentage.textContent = `${100 - aiDetectionScore}%`;
                        scoreFill.style.width = `${100 - aiDetectionScore}%`;
                        
                        // Cambiar color según el nivel de detección
                        if (aiDetectionScore >= 80) {
                            scoreFill.style.backgroundColor = '#4caf50';
                            aiAssessment.textContent = 'El texto parece completamente humano';
                        } else if (aiDetectionScore >= 60) {
                            scoreFill.style.backgroundColor = '#8bc34a';
                            aiAssessment.textContent = 'Baja probabilidad de detección como IA';
                        } else if (aiDetectionScore >= 40) {
                            scoreFill.style.backgroundColor = '#ffc107';
                            aiAssessment.textContent = 'Probabilidad moderada de detección como IA';
                        } else {
                            scoreFill.style.backgroundColor = '#f44336';
                            aiAssessment.textContent = 'Alta probabilidad de detección como IA';
                        }
                        
                        // Guardar en historial
                        saveToHistory(text, humanized, originalWordCount, humanizedWordCount, readability, aiDetectionScore);
                        
                    } catch (error) {
                        console.error('Error:', error);
                        alert('Error al procesar el texto. Por favor, intenta de nuevo.');
                    } finally {
                        // Ocultar indicador de procesamiento
                        processingIndicator.style.display = 'none';
                        humanizeBtn.disabled = false;
                    }
                }, 100);
            });
            
            // Copiar texto humanizado
            copyBtn.addEventListener('click', function() {
                if (!humanizedText.value) {
                    alert('No hay texto para copiar.');
                    return;
                }
                
                humanizedText.select();
                document.execCommand('copy');
                
                // Feedback visual
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '¡Copiado!';
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                }, 2000);
            });
            
            // Descargar texto humanizado
            downloadBtn.addEventListener('click', function() {
                if (!humanizedText.value) {
                    alert('No hay texto para descargar.');
                    return;
                }
                
                const blob = new Blob([humanizedText.value], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'texto_humanizado.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
            
            // Limpiar historial
            clearHistoryBtn.addEventListener('click', function() {
                if (confirm('¿Estás seguro de que quieres borrar todo el historial?')) {
                    localStorage.removeItem('textHumanizerHistory');
                    historyList.innerHTML = '<p>No hay elementos en el historial</p>';
                }
            });
            
            // Funciones para manejar el historial
            function saveToHistory(original, humanized, originalCount, humanizedCount, readability, aiScore) {
                const history = getHistory();
                const newItem = {
                    id: Date.now(),
                    date: new Date().toLocaleString(),
                    original: original,
                    humanized: humanized,
                    originalCount: originalCount,
                    humanizedCount: humanizedCount,
                    readability: readability,
                    aiScore: aiScore
                };
                
                history.unshift(newItem);
                
                // Mantener solo los últimos 10 elementos
                if (history.length > 10) {
                    history.pop();
                }
                
                localStorage.setItem('textHumanizerHistory', JSON.stringify(history));
                loadHistory();
            }
            
            function getHistory() {
                const historyJSON = localStorage.getItem('textHumanizerHistory');
                return historyJSON ? JSON.parse(historyJSON) : [];
            }
            
            function loadHistory() {
                const history = getHistory();
                historyList.innerHTML = '';
                
                if (history.length === 0) {
                    historyList.innerHTML = '<p>No hay elementos en el historial</p>';
                    return;
                }
                
                history.forEach(item => {
                    const historyItem = document.createElement('div');
                    historyItem.className = 'history-item';
                    historyItem.innerHTML = `
                        <div><strong>${item.original.substring(0, 50)}${item.original.length > 50 ? '...' : ''}</strong></div>
                        <div class="history-date">${item.date} - Legibilidad: ${item.readability} - IA: ${100 - item.aiScore}%</div>
                    `;
                    
                    historyItem.addEventListener('click', function() {
                        originalText.value = item.original;
                        humanizedText.value = item.humanized;
                        originalWords.textContent = item.originalCount;
                        humanizedWords.textContent = item.humanizedCount;
                        readabilityScore.textContent = item.readability;
                        qualityIndicator.style.display = 'block';
                        aiScoreElement.style.display = 'block';
                        
                        // Actualizar indicador de IA
                        aiPercentage.textContent = `${100 - item.aiScore}%`;
                        scoreFill.style.width = `${100 - item.aiScore}%`;
                        
                        if (item.aiScore >= 80) {
                            scoreFill.style.backgroundColor = '#4caf50';
                            aiAssessment.textContent = 'El texto parece completamente humano';
                        } else if (item.aiScore >= 60) {
                            scoreFill.style.backgroundColor = '#8bc34a';
                            aiAssessment.textContent = 'Baja probabilidad de detección como IA';
                        } else if (item.aiScore >= 40) {
                            scoreFill.style.backgroundColor = '#ffc107';
                            aiAssessment.textContent = 'Probabilidad moderada de detección como IA';
                        } else {
                            scoreFill.style.backgroundColor = '#f44336';
                            aiAssessment.textContent = 'Alta probabilidad de detección como IA';
                        }
                        
                        // Actualizar contador de palabras
                        const words = item.original ? item.original.split(/\s+/).length : 0;
                        wordCount.textContent = `Palabras: ${words}`;
                    });
                    
                    historyList.appendChild(historyItem);
                });
            }
        });
    </script>
</body>
</html>